/*! Chartinator jQuery plugin 2015-03-30 version: 0.3.0 */
!function(a,b){"use strict";var c=function(c,d){var e=this,f=a(c),g=a(c);return e.fontFamily=a("body").css("font-family").replace(/["']{1}/gi,"")||"Arial, Helvetica, sans-serif",e.optionsInit={urlJSAPI:"https://www.google.com/jsapi",googleSheetKey:!1,columns:!1,colIndexes:!1,rows:!1,tableSel:!1,ignoreRow:[],ignoreCol:[],transpose:!1,tooltipConcat:!1,annotationConcat:!1,chartType:"BarChart",chartClass:"chtr-chart",chartHeightRatio:!1,barChart:{fontSize:!1,chartArea:{left:"20%",top:40,width:"75%",height:"85%"},fontName:e.fontFamily,legend:{position:"bottom"}},pieChart:{fontSize:!1,chartArea:{left:0,top:0,width:"100%",height:"100%"},fontName:e.fontFamily},columnChart:{fontSize:!1,fontName:e.fontFamily,legend:{position:"bottom"}},geoChart:{},calendarChart:{cellScaleFactor:.017,calendar:{monthLabel:{fontSize:!1,fontName:e.fontFamily},dayOfWeekLabel:{fontSize:!1,fontName:e.fontFamily}}},tableChart:{formatter:{type:"none",column:1},allowHtml:!0,cssClassNames:{headerRow:"headerRow",tableRow:"tableRow",oddTableRow:"oddTableRow",selectedTableRow:"selectedTableRow",hoverTableRow:"hoverTableRow",headerCell:"headerCell",tableCell:"tableCell",rowNumberCell:"rowNumberCell"}},showTable:"hide",showTableCSS:{position:"static",top:0,width:""},hideTableCSS:{position:"absolute",top:"-9999px",width:f.width()},showChartCSS:{},hideChartCSS:{opacity:0}},e.cOptions={},e.timer=!1,e.tableClone=!1,e.googleSheetData=!1,e.dataArray=[],e.chartPackage="corechart",e.chartParent=!1,e.windowWidth=!1,e.chartParentWidth=!1,e.init=function(b,c){var d=!1;e.options=a.extend({},e.optionsInit,c),e.options.tableSel&&(f=a(e.options.tableSel+" td").length?a(e.options.tableSel):f),d=f.find("td").length,d&&(e.tableClone=f.clone()),g[0]===f[0]&&(d?g=a('<div class="'+e.options.chartClass+'"></div>').insertAfter(f):f=!1),g.addClass(e.options.chartClass),e.chartParent=g.parent(),e.options.googleSheetKey?e.getGoogleSheet(e.options.googleSheetKey,e.setupChart):e.setupChart()},e.getGoogleSheet=function(b,c){a.ajax({type:"GET",url:"https://spreadsheets.google.com/spreadsheet/pub?key="+b+"&output=csv",dataType:"text"}).done(function(a){e.googleSheetData=a,c()}).fail(function(a){e.googleSheetData=a,c(),console.log("Google Sheet failed")})},e.setupChart=function(){if(e.dataArray=e.collectData(),!e.dataArray.length)return e.showTableChart("show","remove"),void console.log("No data found in data array");if(e.cOptions=a.extend(!0,{},e.options),"BarChart"===e.cOptions.chartType)e.cOptions=e.cOptions.barChart;else if("ColumnChart"===e.cOptions.chartType)e.cOptions=e.cOptions.columnChart;else if("PieChart"===e.cOptions.chartType)e.cOptions=e.cOptions.pieChart;else if("GeoChart"===e.cOptions.chartType)e.cOptions=e.cOptions.geoChart,e.chartPackage="geochart";else if("Calendar"===e.cOptions.chartType)e.cOptions=e.cOptions.calendarChart,e.chartPackage="calendar",e.cOptions.calendar.cellSize=e.cOptions.calendar.cellSize||g.width()*e.cOptions.cellScaleFactor;else{if("Table"!==e.options.chartType)return e.showTableChart("show","remove"),void console.log("Unrecognized chart type");e.cOptions=e.cOptions.tableChart,e.chartPackage="table"}e.showTableChart("hide","hide");try{a.ajax({url:e.options.urlJSAPI,dataType:"script",cache:!0}).done(function(){google.load("visualization","1",{packages:[e.chartPackage],callback:e.drawChart}),e.addResize()}).fail(function(){e.showTableChart("show","remove")})}catch(b){e.showTableChart("show","remove"),console.log(b)}},e.collectData=function(){var b=[];if(e.googleSheetData&&!e.googleSheetData.statusText?b=e.formatSheet(e.googleSheetData):e.googleSheetData&&console.log(e.googleSheetData),e.tableClone&&e.tableClone.find("td").length&&(b=e.getTableData()),e.options.columns)if(b[0]&&b[0][0]&&b[0][0].label)if(e.options.colIndexes)for(var c=0;c<e.options.colIndexes.length;c++)b[0].splice(e.options.colIndexes[c],0,e.options.columns[c]);else b[0]=e.options.columns;else b.unshift(e.options.columns);if(e.options.rows&&b.length)if(e.options.colIndexes)for(var c=0;c<e.options.rows.length;c++)for(var d=0;d<e.options.colIndexes.length;d++)b[c+1].splice(e.options.colIndexes[d],0,e.options.rows[c][d]);else a.merge(b,e.options.rows);return b},e.drawChart=function(){if(e.data=new google.visualization.arrayToDataTable(e.dataArray),!e.data||!e.data.getNumberOfRows())return e.showTableChart("show","remove"),void console.log("Google Charts data table failed");if("none"!==e.options.tableChart.formatter.type){var c=new google.visualization[e.options.tableChart.formatter.type](e.options.tableChart.formatter);c.format(e.data,e.options.tableChart.formatter.column)}if(e.cOptions.fontSize&&isNaN(parseInt(e.cOptions.fontSize,10))&&(e.cOptions.fontSize=e.getFontSize(e.cOptions.fontSize,16)),e.cOptions.titleTextStyle&&e.cOptions.titleTextStyle.fontSize&&isNaN(parseInt(e.cOptions.titleTextStyle.fontSize,10))&&(e.cOptions.titleTextStyle.fontSize=e.getFontSize(e.cOptions.titleTextStyle.fontSize,16)),e.cOptions.calendar&&(e.cOptions.calendar.monthLabel&&e.cOptions.calendar.monthLabel.fontSize&&isNaN(parseInt(e.cOptions.calendar.monthLabel.fontSize,10))&&(e.cOptions.calendar.monthLabel.fontSize=e.getFontSize(e.cOptions.calendar.monthLabel.fontSize,16)),e.cOptions.calendar.dayOfWeekLabel&&e.cOptions.calendar.dayOfWeekLabel.fontSize&&isNaN(parseInt(e.cOptions.calendar.dayOfWeekLabel.fontSize,10))&&(e.cOptions.calendar.dayOfWeekLabel.fontSize=e.getFontSize(e.cOptions.calendar.dayOfWeekLabel.fontSize,16))),e.cOptions.title=e.cOptions.title||e.tableClone.find("caption").text()||"",e.options.chartHeightRatio&&!e.cOptions.height&&(e.cOptions.height=g.width()*e.options.chartHeightRatio),"BarChart"===e.options.chartType&&!e.options.chartHeightRatio&&!e.cOptions.height){var d=e.cOptions.fontSize||e.getFontSize("body",16);e.cOptions.height=2*d*e.data.getNumberOfRows()}e.chart=new google.visualization[e.options.chartType](g.get(0)),google.visualization.events.addListener(e.chart,"ready",function(){e.showTableChart(e.options.showTable,"show"),e.windowWidth=a(b).width(),e.chartParentWidth=e.chartParent.width()}),google.visualization.events.addListener(e.chart,"error",function(){e.showTableChart("show","remove")}),e.chart.draw(e.data,e.cOptions)},e.formatSheet=function(a){var b=[];if(a&&!a.statusText)try{for(var c=a.split(/\r\n|\n/),d=[],f=0;f<c.length;f++){var g=c[f].split(",");c[f]=g}e.options.transpose&&(c=e.transpose(c)),d=c[0];for(var f=0;f<d.length;f++)d[f]="TOOLTIP"===d[f].toUpperCase()?{type:"string",role:"tooltip"}:"ANNOTATION"===d[f].toUpperCase()?{type:"string",role:"annotation"}:{label:d[f]};b=c,b[0]=d,b=e.formatData(b)}catch(h){console.log(h)}return b},e.getTableData=function(){var b=[];try{var c=e.tableClone.find("tr"),d=[];c.each(function(b){d.push([]),a(this).find("td, th").each(function(){var c=a(this),e={};c.attr("data-type")&&(e.type=c.attr("data-type")),c.attr("data-role")&&(e.role=c.attr("data-role")),e.label=c.text(),d[b].push(e)})}),e.options.transpose&&(d=e.transpose(d)),b.push(d[0]);for(var f=1;f<d.length;f++){for(var g=[],h=0;h<d[f].length;h++){var i=d[f][h].label||"";g.push(i)}g.length>0&&b.push(g)}b=e.formatData(b)}catch(j){return console.log(j),[]}return b},e.formatData=function(b){var c=b;try{var d=[],f=[],g=[],h=function(a,b){return-1===e.options.ignoreRow.indexOf(b)},i=function(a,b){return-1===e.options.ignoreCol.indexOf(b)},j=function(a,b){return-1===d.indexOf(b)};e.options.tooltipConcat&&f.push("tooltip"),e.options.annotationConcat&&f.push("annotation"),c=a.grep(c,h);for(var k=0;k<c.length;k++)c[k]=a.grep(c[k],i);if(f.length){for(var l="",m=0;m<c[0].length;m++){var n=c[0][m].role||"";n&&-1!==f.indexOf(n)&&d.push(m)}for(var k=0;k<c.length;k++)c[k]=a.grep(c[k],j);for(var m=0;m<c[0].length;m++){var n=c[0][m].role||"",o=c[0][m].label||"";if(("domain"===n||0===m)&&(l=c[0][m]),(!n||-1===f.indexOf(n))&&m>0)for(var k=0;k<f.length;k++)m++,c[0].splice(m,0,{type:"string",role:f[k]}),g.push({index:m,domain:l,role:f[k],label:o})}for(var m=1;m<c.length;m++)for(var k=0;k<g.length;k++){var p="";"toolip"===g[k].role?p=e.options.tooltipConcat:"annotation"===g[k].role&&(p=e.options.annotationConcat),p=p.replace(new RegExp("domain","g"),g[k].domain),p=p.replace(new RegExp("label","g"),g[k].label),p=p.replace(new RegExp("data","g"),c[m][g[k].index]),c[m].splice(g[k].index,0,p)}}for(var m=1;m<c.length;m++){for(var q=[],k=0;k<c[m].length;k++){var r=c[0][k].type||"",s=c[0][k].role||"",t=c[m][k]||"";if(-1===["tooltip","annotation"].indexOf(s))if("date"===r||"datetime"===r)t=new Date(t);else if("number"===r)t=parseFloat(t);else if("boolean"===r){var u=t.toLowerCase();t="false"!==u&&"0"!==u&&"no"!==u&&""!==u}else"timeofday"===r?t=t.getTime():0!==k&&(isNaN(parseFloat(t))?"Invalid Date"===new Date(t)||isNaN(new Date(t))||(t=new Date(t)):t=parseFloat(t));q.push(t)}q.length>0&&(c[m]=q)}}catch(v){return console.log(v),[]}return c},e.addResize=function(){a(b).on({resize:function(){clearTimeout(e.timer),e.timer=setTimeout(function(){if(a(b).width()!==e.windowWidth){var c=g.attr("style");g.removeAttr("style"),e.chartParent.width()!==e.chartParentWidth?(e.cOptions.calendar&&!e.options.calendarChart.calendar.cellSize&&(e.cOptions.calendar.cellSize=.017*g.width()),e.options.chartHeightRatio&&!(e.options.barChart.height||e.options.pieChart.height||e.options.columnChart.height||e.options.geoChart.height||e.options.calendarChart.height)&&(e.cOptions.height=g.width()*e.options.chartHeightRatio),e.chart.draw(e.data,e.cOptions)):g.attr("style",c)}},500)}})},e.showTableChart=function(a,b){var c=f?f.length:!1,d=g?g.length:!1;"show"===a&&c?(f.css("opacity",0),f.css(e.options.showTableCSS),f.fadeTo(400,1)):"hide"===a&&c?f.css(e.options.hideTableCSS):"remove"===a&&c&&f.css("display","none"),"show"===b&&d?(g.css("opacity",0),g.css(e.options.showChartCSS),g.fadeTo(400,1)):"hide"===b&&d?g.css(e.options.showChartCSS):"remove"===b&&d&&g.css("display","none")},e.getFontSize=function(b,c){return parseInt(a(b).css("fontSize"),10)||c},e.transpose=function(a){for(var b=new Array(a[0].length),c=0;c<a[0].length;c++){b[c]=new Array(a.length);for(var d=0;d<a.length;d++)b[c][d]=a[d][c]}return b},e.init(c,d),this};a.fn.chartinator=function(b){return this.each(function(){var d=a(this);d.data("chartinator")||a(this).data("chartinator",new c(this,b))})}}(jQuery,window,document,Math);